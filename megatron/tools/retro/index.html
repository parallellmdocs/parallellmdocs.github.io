
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="中文翻译文档集合">
      
      
      
      
        <link rel="prev" href="../../examples/multimodal/">
      
      
        <link rel="next" href="build_db/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Retro 工具 - Unified Docs (CN)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#retro-instructretro" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Unified Docs (CN)" class="md-header__button md-logo" aria-label="Unified Docs (CN)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Unified Docs (CN)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Retro 工具
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Unified Docs (CN)" class="md-nav__button md-logo" aria-label="Unified Docs (CN)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Unified Docs (CN)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Megatron
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Megatron
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    概览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    快速入门
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            快速入门
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/QuickStart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    快速开始
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/datasets/readme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数据集管线
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/llama_mistral/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Llama/Mistral 指南
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    核心能力
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            核心能力
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/MSC_Integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSC 集成
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/README_STRAGGLER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Straggler 检测
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/transformer/moe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MoE 架构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/optimizer/cpu_offloading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    优化器 CPU Offload
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/models/mimo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MIMO 模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/distributed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分布式 FSDP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../megatron/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    核心概览
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API 指南
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            API 指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    导航
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/transformer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformer 主体
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/tensor_parallel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    张量并行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/pipeline_parallel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    流水线并行
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/context_parallel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Parallel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/moe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MoE 系统
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/multi_latent_attention/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Latent Attention
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/multi_token_prediction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    多 Token 预测
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/dist_optimizer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分布式优化器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/custom_fsdp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自定义 FSDP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/dist_checkpointing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    检查点策略
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/tokenizers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分词体系
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" checked>
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    示例与工具
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            示例与工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/user-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    示例导航
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    模型导出
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/inference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    推理实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/multimodal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    多模态示例
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Retro 工具
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="build_db/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retro 数据库构建
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retro 微调
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_6" >
        
          
          <label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    进一步阅读
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_6">
            <span class="md-nav__icon md-icon"></span>
            进一步阅读
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/models.bert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API 参考：BERT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/models.gpt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API 参考：GPT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/models.t5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API 参考：T5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/optimizer_param_scheduler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    优化器调度
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/optimizer_cpu_offload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CPU Offload 参考
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docs/source/api-guide/distributed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自定义分布式
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    TransformerEngine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            TransformerEngine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    概览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    安装指南
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    调试工具
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            调试工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    目录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/1_getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    快速入门
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/2_config_file_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    配置结构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/3_api_debug_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    初始化 API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/3_api_features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    功能列表
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/3_api_te_calls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inspect API 调用
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API 索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/debug/4_distributed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分布式调试
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API 参考
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            API 参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/api/common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    通用配方
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/api/framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    框架专属 API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/api/pytorch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyTorch API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../transformerengine/docs/api/jax/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JAX API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    NCCL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            NCCL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../nccl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    概览
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="retro-instructretro">Retro 与 InstructRetro</h1>
<p>Retro <a href="https://arxiv.org/abs/2112.04426">(Borgeaud et al., 2022)</a> 是一种采用检索增强预训练的自回归解码器式语言模型。
借助检索能力，Retro 可以从万亿级别的标注语料中检索，从零开始完成大规模预训练，并在实际部署中具备良好的扩展性。
与仅依赖模型参数隐式存储事实知识的标准 GPT 相比，引入检索可以更高效地存储事实知识，从而在显著降低参数量的同时实现更低的困惑度。
此外，通过更新检索数据库即可更新语言模型中的知识 <a href="https://arxiv.org/abs/2304.06762">(Wang et al., 2023a)</a>，无需重新训练模型。</p>
<p>InstructRetro <a href="https://arxiv.org/abs/2310.07713">(Wang et al., 2023b)</a> 在 Retro 的基础上进一步扩展至 480 亿参数，是截至 2023 年 12 月最大的检索增强式预训练语言模型。
经过指令微调的 InstructRetro 在零样本场景下显著优于同等规模的 GPT：在 8 个短文本问答任务上平均提升 7%，在 4 个高难度长文本问答任务上提升 10%，在 3 个摘要任务上提升 16%。
我们还发现，移除 InstructRetro 的编码器并直接将其解码器骨架作为 GPT 使用，仍可获得与原模型相当的效果。</p>
<p>本文档提供了一个复现 Retro 与 InstructRetro 的端到端教程。</p>
<h1 id="_1">目录</h1>
<ul>
<li><a href="#检查点">检查点</a></li>
<li><a href="#端到端复现指南">端到端复现指南</a><ul>
<li><a href="#步骤-0环境准备">步骤 0：环境准备</a><ul>
<li><a href="#docker-镜像">Docker 镜像</a></li>
<li><a href="#安装依赖">安装依赖</a></li>
</ul>
</li>
<li><a href="#步骤-1构建检索数据库">步骤 1：构建检索数据库</a></li>
<li><a href="#步骤-2预训练">步骤 2：预训练</a></li>
<li><a href="#步骤-3困惑度评估">步骤 3：困惑度评估</a></li>
<li><a href="#步骤-4指令微调">步骤 4：指令微调</a></li>
<li><a href="#步骤-5下游任务评估">步骤 5：下游任务评估</a></li>
</ul>
</li>
<li><a href="#引用">引用</a></li>
</ul>
<h1 id="_2">检查点</h1>
<p>下表给出了 Retro 与 InstructRetro 的预训练检查点，可通过以下链接下载：</p>
<table>
<thead>
<tr>
<th>模型</th>
<th>参数规模</th>
<th>指令微调</th>
<th>下载链接 1</th>
<th>下载链接 2</th>
<th>下载链接 3</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>retro-8b-base-4k</code></td>
<td>8B</td>
<td></td>
<td><a href="https://huggingface.co/nvidia/retro-8b-base-4k">Huggingface</a></td>
<td><a href="https://catalog.ngc.nvidia.com/orgs/nvidia/models/retro-8b-base-4k">NGC</a></td>
<td><a href="https://drive.google.com/drive/folders/1uSQ5DAsuvx_8XcbtnVfs_MGvEOcx0uK_?usp=sharing">Google Drive</a></td>
</tr>
<tr>
<td><code>retro-8b-instruct-4k</code></td>
<td>8B</td>
<td>是</td>
<td><a href="https://huggingface.co/nvidia/retro-8b-instruct-4k">Huggingface</a></td>
<td><a href="https://catalog.ngc.nvidia.com/orgs/nvidia/models/retro-8b-instruct-4k">NGC</a></td>
<td><a href="https://drive.google.com/drive/folders/1v5dKaSN0cm2lwyAWpFaJtlTrLhtMZXsI?usp=sharing">Google Drive</a></td>
</tr>
<tr>
<td><code>retro-48b-base-4k</code></td>
<td>48B</td>
<td></td>
<td><a href="https://huggingface.co/nvidia/retro-48b-base-4k">Huggingface</a></td>
<td><a href="https://catalog.ngc.nvidia.com/orgs/nvidia/models/retro-48b-base-4k">NGC</a></td>
<td><a href="https://drive.google.com/drive/folders/1rtNpf0CiLElSHQcr3aLI3zgfI3teGTP5?usp=sharing">Google Drive</a></td>
</tr>
<tr>
<td><code>retro-48b-instruct-4k</code></td>
<td>48B</td>
<td>是</td>
<td><a href="https://huggingface.co/nvidia/retro-48b-instruct-4k">Huggingface</a></td>
<td><a href="https://catalog.ngc.nvidia.com/orgs/nvidia/models/retro-48b-instruct-4k">NGC</a></td>
<td><a href="https://drive.google.com/drive/folders/1qdb0AQjSsAPGlWaIu3wgHPjf_nwLeY5h?usp=sharing">Google Drive</a></td>
</tr>
</tbody>
</table>
<h1 id="_3">端到端复现指南</h1>
<p>本教程覆盖了 InstructRetro 端到端复现的各个环节：包括大规模检索构建、预训练、困惑度评估、指令微调以及下游任务评估。</p>
<p>如果你只关注评估，可直接下载我们<a href="#检查点">公开的检查点</a>，并跳到 <a href="#步骤-5下游任务评估">步骤 5</a> 进行下游任务评估。</p>
<h2 id="0">步骤 0：环境准备</h2>
<p>建议在 Docker 环境中运行以下流程。</p>
<h3 id="docker">Docker 镜像</h3>
<p>我们在 <a href="examples/Dockerfile">tools/retro/examples/Dockerfile</a> 提供了用于复现的 Docker 构建文件，基于 <a href="https://catalog.ngc.nvidia.com/orgs/nvidia/containers/pytorch/tags">NGC Docker</a> <code>nvcr.io/nvidia/pytorch:23.09-py3</code> 镜像。</p>
<h3 id="_4">安装依赖</h3>
<p>克隆 Megatron 仓库：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>InstructRetro<span class="w"> </span>https://github.com/NVIDIA/Megatron-LM.git
</code></pre></div>
<p>如果无法使用 Docker，建议从干净的 Conda 环境开始，并安装以下运行时依赖：</p>
<ul>
<li>Python 3.10</li>
<li>NVIDIA CUDA® 12.2.1</li>
<li>NVIDIA cuBLAS 12.2.5.6</li>
<li>NVIDIA cuDNN 8.9.5</li>
<li>NVIDIA NCCL 2.18.5</li>
<li>PyTorch 2.1.0a0+32f93b1</li>
</ul>
<p>随后安装 Retro 相关依赖：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>faiss-gpu
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>transformers
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>sentencepiece
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>h5py
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>nltk
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>einops
</code></pre></div>
<h2 id="1">步骤 1：构建检索数据库</h2>
<p>本步骤通过 <a href="https://github.com/facebookresearch/faiss">Faiss</a> 构建用于 InstructRetro 的大规模检索数据库，从万亿 token 中检索，并预处理（及保存）供预训练使用的检索邻居。</p>
<p>详见 <a href="build_db/">tools/retro/build_db.md</a>。</p>
<h2 id="2">步骤 2：预训练</h2>
<p><em>务必先完成步骤 1 中的检索数据库构建，以确保预处理的检索邻居与预训练语料完全匹配。</em></p>
<p>预训练阶段同时支持从零训练 Retro 以及在已训练的 GPT 模型上继续预训练。</p>
<p>我们提供了一个示例脚本用于从零训练 8.43 亿参数的 Retro。请根据自身配置修改 <a href="examples/pretrain_model.sh">tools/retro/examples/pretrain_model.sh</a>，并确保数据路径与步骤 1 使用的路径一致，以便检索邻居与语料对应。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>bash<span class="w"> </span>tools/retro/examples/pretrain_model.sh
</code></pre></div>
<p>预训练完成后，如果在 <code>pretrain_model.sh</code> 中指定了 <code>--save</code>，模型检查点会保存到该目录。</p>
<p>若希望在已有的 GPT 模型上继续训练带检索的 Retro，请在 <code>pretrain_model.sh</code> 中配置 <code>--load</code> 指向 GPT 检查点（GPT 与 Retro 的隐藏尺寸、层数、激活函数等架构需完全一致）。同时需要设置 <code>--no-load-optim --finetune</code>，确保不会加载 GPT 的优化器状态，从一个干净的检索增强训练开始。
首个作业/首轮运行完成后，可继续从最新检查点接续训练。在后续作业中，应去掉 <code>--no-load-optim --finetune</code>，以便正确加载上一次作业的优化器状态。</p>
<h2 id="3">步骤 3：困惑度评估</h2>
<p>预训练过程中，程序会按照 <code>--eval-interval</code> 间隔自动在指定的验证语料上评估困惑度。该验证语料需与步骤 1 中使用的语料完全一致，以确保检索邻居匹配。</p>
<p>如果只想评估已训练模型的困惑度，可在 <code>pretrain_model.sh</code> 中添加 <code>--skip-train</code>，跳过训练阶段，仅对 <code>--load</code> 指定的模型在验证集上计算困惑度。再次运行上述命令即可。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>bash<span class="w"> </span>tools/retro/examples/pretrain_model.sh
</code></pre></div>
<h2 id="4">步骤 4：指令微调</h2>
<p>在该步骤中，我们使用指令数据对预训练模型进行微调，并提供示例脚本微调 8.43 亿参数的 Retro。</p>
<p>我们还开源了一套可混合使用的指令微调数据集，可在<a href="https://drive.google.com/file/d/1nzKwwYf8lYb9gN3P4YO8pFNU_B2nMYe1/view?usp=sharing">此链接</a>下载。该数据集包含以下开源指令调优语料：</p>
<h3 id="_5">指令微调数据集构成</h3>
<table>
<thead>
<tr>
<th>数据集</th>
<th style="text-align: right;">样本数</th>
<th style="text-align: right;">轮数</th>
<th style="text-align: right;">采样概率</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://arxiv.org/abs/2212.10465">soda</a></td>
<td style="text-align: right;">2560</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr>
<td><a href="https://arxiv.org/abs/1907.09190">eli5</a></td>
<td style="text-align: right;">2561</td>
<td style="text-align: right;">0.055</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr>
<td><a href="https://arxiv.org/abs/2212.10560">self_instruct_short</a></td>
<td style="text-align: right;">1280</td>
<td style="text-align: right;">0.043</td>
<td style="text-align: right;">0.010</td>
</tr>
<tr>
<td><a href="https://arxiv.org/abs/2212.10560">self_instruct_long</a></td>
<td style="text-align: right;">2560</td>
<td style="text-align: right;">0.333</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr>
<td><a href="https://arxiv.org/abs/2212.09689">unnatural-instructions</a></td>
<td style="text-align: right;">2560</td>
<td style="text-align: right;">0.024</td>
<td style="text-align: right;">0.020</td>
</tr>
<tr>
<td><a href="https://arxiv.org/abs/2210.11416">flan_cot</a></td>
<td style="text-align: right;">1280</td>
<td style="text-align: right;">0.093</td>
<td style="text-align: right;">0.010</td>
</tr>
<tr>
<td><a href="https://arxiv.org/abs/2305.13735">dolly</a></td>
<td style="text-align: right;">6400</td>
<td style="text-align: right;">0.938</td>
<td style="text-align: right;">0.050</td>
</tr>
<tr>
<td><a href="https://open-assistant.io/">oasst-skip-noncode</a></td>
<td style="text-align: right;">104558</td>
<td style="text-align: right;">1.839</td>
<td style="text-align: right;">0.817</td>
</tr>
<tr>
<td><a href="https://open-assistant.io/">oasst-skip-code</a></td>
<td style="text-align: right;">4243</td>
<td style="text-align: right;">1.839</td>
<td style="text-align: right;">0.033</td>
</tr>
</tbody>
</table>
<p>如需了解各指令数据集的更多细节，请参阅上表所列论文。</p>
<p><em>请注意，上述指令数据集均来自公开资源，与 <a href="https://arxiv.org/abs/2310.07713">InstructRetro</a> 使用的数据集略有差异；后者包含部分私有与商业数据集，因此在下游任务上可能存在 1-2% 的精度差异。</em></p>
<h3 id="_6">指令微调脚本</h3>
<p>将<a href="https://drive.google.com/file/d/1nzKwwYf8lYb9gN3P4YO8pFNU_B2nMYe1/view?usp=sharing">混合指令数据集</a>下载到数据目录 <code>$DATA_HOME</code>，并修改 <a href="sft/sft_retro_lm.sh">tools/retro/sft/sft_retro_lm.sh</a> 示例脚本。</p>
<p>以下示例命令演示了如何在 8.43 亿参数的 Retro 上进行指令微调：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">                                      </span><span class="o">[</span>blend-dataset-name<span class="o">]</span><span class="w"> </span><span class="o">[</span>model-size<span class="o">]</span><span class="w"> </span><span class="o">[</span>batch-size<span class="o">]</span><span class="w">  </span><span class="o">[</span>lr<span class="o">]</span><span class="w">    </span><span class="o">[</span>checkpoints<span class="o">]</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>bash<span class="w"> </span>tools/retro/sft/sft_retro_lm.sh<span class="w">       </span>open_inst<span class="w">               </span>843m<span class="w">            </span><span class="m">128</span><span class="w">    </span>5e-6<span class="w">  </span>&lt;path/to/pretrained/retro&gt;
</code></pre></div>
<p><code>blend_dataset_name</code> 参数会根据 <code>${blend_dataset_name}.sh</code> 中定义的权重与配置（示例中的 <a href="sft/open_inst.sh">open_inst.sh</a>）对 <code>$DATA_HOME</code> 内的数据集进行加权混合。
微调后的检查点将保存至 <code>--save</code> 指定目录，例如 <code>&lt;SFT_HOME&gt;/checkpoints/applications/retro-sft_pp1_same_format_ctx1_843m_128_5e-6</code>。</p>
<h2 id="5">步骤 5：下游任务评估</h2>
<p>本步骤展示如何在零样本设定下评估 InstructRetro 在问答等下游任务上的表现。我们提供了经过统一格式预处理的开源评测数据集，可从<a href="https://drive.google.com/drive/folders/1xw-N0LJR_lIWnH6BKzHIb49quVCS_V72?usp=sharing">此链接</a>下载。请沿用步骤 0-4 中的 retro 工作目录，确保检索邻居与预训练语料匹配。
如果只执行步骤 5，可参考示例 retro 工作目录及 8 亿参数模型的 <code>args.json</code>（下载链接在<a href="https://drive.google.com/file/d/121GqAdMvf8bJEBZRt-SD4uhW-SRWgI3s/view?usp=sharing">这里</a>），命令行参数可覆盖 JSON 中的设置。</p>
<p>下方示例命令演示了使用 InstructRetro 检查点在 Natural Question (NQ) 任务上的生成过程，适用于步骤 4 获得的 8.43 亿参数 InstructRetro。请根据实际数据集路径进行修改，并在使用其它检查点时调整命令。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>bash<span class="w"> </span>tools/retro/text_generation/retro_generate.sh<span class="w"> </span>nq<span class="w"> </span>843m<span class="w"> </span>greedy<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="m">20000</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>pp1<span class="w"> </span>&lt;SFT_HOME&gt;/checkpoints/applications/retro-sft_pp1_same_format_ctx1_843m_128_5e-6<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>生成的结果会保存到对应检查点目录，例如：
<code>&lt;SFT_HOME&gt;/checkpoints/applications/retro-sft_pp1_same_format_ctx1_843m_128_5e-6/retro-generate-nq_5_2_843m_test_greedy_0_20000_1000.txt</code>。</p>
<p>如果需要计算 F1 / Exact Match (EM) 分数，可运行以下脚本（请根据任务与检查点更新数据集路径）：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>python3<span class="w"> </span>tools/retro/text_generation/evaluate.py
</code></pre></div>
<h1 id="_7">引用</h1>
<p>更多技术细节可参阅以下论文：</p>
<p><a href="https://arxiv.org/abs/2304.06762">Shall we Pretrain Autoregressive Language Models with Retrieval? A Comprehensive Study.</a></p>
<p><em>Boxin Wang, Wei Ping, Peng Xu, Lawrence McAfee, Zihan Liu, Mohammad Shoeybi, Yi Dong, Oleksii Kuchaiev, Bo Li, Chaowei Xiao, Anima Anandkumar, Bryan Catanzaro.</em>（EMNLP 2023）</p>
<p><a href="https://arxiv.org/abs/2310.07713">InstructRetro: Instruction Tuning post Retrieval-Augmented Pretraining.</a></p>
<p><em>Boxin Wang, Wei Ping, Lawrence McAfee, Peng Xu, Bo Li, Mohammad Shoeybi, Bryan Catanzaro.</em></p>
<p>若你在研究或项目中使用了本仓库的数据或代码，请按照以下格式引用：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nc">@inproceedings</span><span class="p">{</span><span class="nl">wang2023shall</span><span class="p">,</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="na">title</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">{Shall We Pretrain Autoregressive Language Models with Retrieval? A Comprehensive Study}</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="na">author</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">{Boxin Wang and Wei Ping and Peng Xu and Lawrence McAfee and Zihan Liu and Mohammad Shoeybi and Yi Dong and Oleksii Kuchaiev and Bo Li and Chaowei Xiao and Anima Anandkumar and Bryan Catanzaro}</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="na">journal</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">{The 2023 Conference on Empirical Methods in Natural Language Processing}</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="na">year</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">{2023}</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">}</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="nc">@article</span><span class="p">{</span><span class="nl">wang2023instructretro</span><span class="p">,</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="na">title</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="s">{InstructRetro: Instruction Tuning post Retrieval-Augmented Pretraining}</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="na">author</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="s">{Boxin Wang and Wei Ping and Lawrence McAfee and Peng Xu and Bo Li and Mohammad Shoeybi and Bryan Catanzaro}</span><span class="p">,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="na">year</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">{2023}</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="na">journal</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">{arXiv preprint arXiv: 2310.07713}</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>